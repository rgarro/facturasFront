<div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <h4 class="tituloBrandNav cardTitle"><i class="fa fa-map-signs"></i> Companies</h4>
            <button class="btn btn-outline-primary btn-sm new-company-btn"><i class="fa fa-plus"></i></button><br>
            <table id="companiesDataTable" class="table table-striped display">
              <thead>
                <tr>
                    <th class="company-head"></th>
                    <th class="email-head"></th>
                    <th class="entered-head"></th>
                    <th class="phone-head"></th>
                    <th>&nbsp;</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>

            <!-- Modal -->
          <div class="modal fade" id="companyFormModal" tabindex="-1" role="dialog" aria-labelledby="createCompanyModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
          <div class="modal-header">
          <h5 class="modal-title newcompany" id="createUserCompanyLabel">Modal title</h5>
          <button id="banksBtn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#companyBanksModal"><i class="fa fa-bank"></i> </button>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          </div>
          <div class="modal-body ">
          <form id="companyFrm" method="post" enctype="multipart/form-data">
            <input id="CompanyID" class="hid-company-id" type="hidden" name="Company[CompanyID]" value=""/>

            <div class="form-group">
              <div class="progress">
                <div id="calleElProgreso" class="progress-bar progress-bar-striped bg-success" role="progressbar" style="width: 0%;display:none;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <img src="" class="icon-choose-image"/><br>
            Logo:  <input type="File" name="photo" id="companyLogo" size="40" value="" accept="image/*"/>
              <input id="ciaLogo" class="hid-cialogo-id" type="hidden" name="Company[Logo]" value=""/>
            </div>
            <div class="form-group">
                * <label for="companyLocaleCode" class="localecode-head col-form-label">LocaleCode</label>

                <select name="Company[LocaleCode]" class="form-control form-control-sm " id="companyLocaleCode" required="required">
                  <option value="en_US">English</option>
                  <option value="es_CR">Español</option>
                </select>

              </div>
              <div class="form-group">
                  <label for="cColorInput" class="bgcolor-head col-form-label">*BgColor</label>
                  <input type="color" value="#80ff00" name="Company[BgColor]" id="cColorInput"  required="required">
              </div>
              <div class="form-group">
                  <label for="cNameInput" class="companyname-head col-form-label">CompanyName</label>
                  <input type="text" name="Company[CompanyName]" class="form-control form-control-sm" id="cNameInput" placeholder="Acme" required="required">
              </div>
              <div class="form-group">
                  <label for="commercialNameInput" class="commercialname-head col-form-label">CommercialName</label>
                  <input type="text" name="Company[CommercialName]" class="form-control form-control-sm" id="commercialNameInput" placeholder="Acme Inc" required="required">
              </div>
              <!--<div class="form-group">
                  <label for="cedJuriInput" class="legalced-head col-form-label">Cédula Jurídica</label>
                  <input type="text" name="Company[CedulaJuridica]" class="form-control form-control-sm" id="cedJuriInput" placeholder="00000000000">
                </div> -->
                <div class="form-group">
                    <label for="addressInput" class="direccion-head col-form-label">Direccion</label>
                    <input type="text" name="Company[Address]" class="form-control form-control-sm" id="addressInput" placeholder="avenida54 calle25" required="required">
                  </div>
                <div class="form-group">
                  *  <label for="acodeNameInput" class="acodename-head col-form-label">AreaCode</label>
                  <input type="number" name="Company[AreaCode]" maxlength="3" size="3" class="form-control form-control-sm" id="acodeNameInput" placeholder="506" required="required">
                </div>
                <div class="form-group">
                  *  <label for="phoneNameInput" class="phonename-head col-form-label">Phone</label>
                  <input type="number" name="Company[Phone]" minlength="8" maxlength="8" size="8" class="form-control form-control-sm" id="phoneNameInput" placeholder="80000000" required="required">
                </div>
                <div class="form-group">
                  <label for="intphoneNameInput" class="faxphonename-head col-form-label">Phone</label>
                  <input type="number" name="Company[Fax]" minlength="5" maxlength="20" size="8" class="form-control form-control-sm" id="intphoneNameInput" placeholder="80000">
                </div>
                <div class="form-group">
                  * <label for="clientEmailInput" class="email-head col-form-label">Email</label>
                  <input type="email" name="Company[Email]" class="form-control form-control-sm" id="clientEmailInput" placeholder="name@example.com" required="required">
                </div>
                <div class="form-group">
                  * <label for="clientReplyToInput" class="replyto-head col-form-label">ReplyTo</label>
                  <input type="email" name="Company[ReplyTo]" class="form-control form-control-sm" id="clientReplyToInput" placeholder="name@example.com">
                </div>
                <div class="form-group">
                  * <label for="emailSbjInput" class="emailsbj-head col-form-label">EmailSubject</label>
                  <input type="text" name="Company[EmailSubject]" class="form-control form-control-sm" id="emailSbjInput" placeholder="Invoice Number">
                </div>
          </form>
          </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary btn-sm" data-dismiss="modal"><i class="fa fa-window-close-o"></i> </button>
          <button type="submit" form="companyFrm" class="btn btn-outline-primary btn-sm"><i class="fa fa-database"></i></button>
          </div>
          </div>
          </div>
          </div>
          <!-- end modal -->
          <!-- Modal -->
        <div class="modal fade" id="companyBanksModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
        ...asdfasdf
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
        </div>
        </div>
        </div>
        </div>

                  <button class="btn btn-outline-primary btn-sm new-company-btn"><i class="fa fa-plus"></i></button>
          </div>
        </div>
      </div>
    </div>
    <script>
    $(document).ready(function(){

      //Translatables
      $(".faxphonename-head").html("<i class='fa fa-fax'></i> " + translate('Fax'));
      $(".phonename-head").html("<i class='fa fa-phone'></i> " + translate('Phone'));
      $(".acodename-head").html("<i class='fa fa-hashtag'></i> " + translate('AreaCode'));
      $(".direccion-head").html("<i class='fa fa-car'></i> " + translate('Address'));
      $(".legalced-head").html("<i class='fa fa-drivers-license'></i> " + translate('LegalCed'));
      $(".commercialname-head").html("<i class='fa fa-map-signs'></i> " + translate('ComercialName'));
      $(".companyname-head").html("<i class='fa fa-building'></i> " + translate('CompanyName'));
      $(".localecode-head").html("<i class='fa fa-globe'></i> " + translate('LocaleCode'));
      $(".cardTitle").html("<i class='fa fa-male'></i> " + translate('Companies'));
      $(".company-head").html("<i class='fa fa-address-card'></i> " + translate('Company'));
      $(".email-head").html("<i class='fa fa-envelope'></i> " + translate('Email'));
      $(".replyto-head").html("<i class='fa fa-envelope'></i> " + translate('ReplyTo'));
      $(".entered-head").html("<i class='fa fa-calendar'></i> " + translate('Since'));
      $(".phone-head").html("<i class='fa fa-phone'></i> " + translate('Phone'));
      $(".new-company-btn").html("<i class='fa fa-plus'></i> " + translate('NewCompany'));
      $(".newcompany").html("<i class='fa fa-building'></i> " + translate('NewCompany'));

      var crfut_companies = new CRFut.AdminModules.Companies();
      var data_lang_url = (translate.getLocale() == "es" ? "datalang/spanish.json" : "datalang/english.json");
      //console.log(current_user);
      var encoded_user_id = $.base64.encode(current_user.UserID);

      $(".new-company-btn").on("click",function(){
        $("#CompanyID").val(" ");
         $('#banksBtn').hide();
        $('#companyFormModal').modal('show');
      });

      $('#companiesDataTable tbody').on( 'click', '.delete-company-btn',function(){
        var cia_data = crfut_companies.table.row( $(this).parents('tr') ).data();
        if(window.confirm(translate('ConfirmD'))){
          crfut_companies.delete(cia_data);
        }
      });


      crfut_companies.table = $('#companiesDataTable').DataTable( {
             "processing": true,
             "serverSide": true,
             "paging": true,
             "ajax": {
                 "url": crfut_companies.dataTableUrl + "?token="+Cookies.get("token") +"&user_id=" + encoded_user_id,
                 "type": "POST",
                 "dataSrc": (function (json) {
                   if(json.token_is_absent ==1){
                     crfut_companies.alert_error(translate('AbsentToken'));
                       window.location = "index.html";
                   }
                    if(json.token_is_expired ==1){
                      crfut_companies.alert_error(translate('SesExpired'));
                        window.location = "index.html";
                    }
                    return json.data;
                }).bind(this)
             },
             "columns": [
               { "data": "CompanyName", "orderable": true ,"searchable":true},
                 { "data": "Email", "orderable": false ,"searchable":true },
                 { "data": "Entered", "orderable": false,"searchable":false },
                 { "data": "Phone", "orderable": false,"searchable":false },
                 {
                   data:"",
                   defaultContent: "<button type='button' class='btn btn-outline-primary btn-sm edit-company-btn'><i class='fa fa-edit'></i></button> <button type='button' class='btn btn-outline-warning btn-sm delete-company-btn'><i class='fa fa-trash'></i></button>",
                   "orderable": false,
                   "searchable":false
                 }
             ],
             "language": {
               "url": data_lang_url,
             },
         });

         var $company_locale_select = $('#companyLocaleCode');

         $('#companiesDataTable tbody').on( 'click', '.edit-company-btn',function(){
           var data = crfut_companies.table.row( $(this).parents('tr') ).data();
             $("#CompanyID").val(data.CompanyID);
             $("#ciaLogo").val(data.Logo);
             $(".icon-choose-image").attr("src",crfut_companies.getLogoUrl(data.CompanyID,data.Logo));
             if(data.LocaleCode == "es_CR"){
               $company_locale_select.filter('[value="es_CR"]').prop('selected', true);
               $company_locale_select.filter('[value="en_US"]').prop('selected', false);
             }else{
               $company_locale_select.filter('[value="es_CR"]').prop('selected', false);
               $company_locale_select.filter('[value="en_US"]').prop('selected', true);
             }
             $("#cNameInput").val(data.CompanyName);
             $("#cColorInput").val(data.BgColor);
             $("#commercialNameInput").val(data.CommercialName);
             $("#addressInput").val(data.Address);
             $("#acodeNameInput").val(data.AreaCode);
             $("#phoneNameInput").val(data.Phone);
             $("#intphoneNameInput").val(data.Fax);
             $("#clientEmailInput").val(data.Email);
             $("#clientReplyToInput").val(data.ReplyTo);
             $("#emailSbjInput").val(data.EmailSubject);

             $('#companyFormModal').modal('show');
             $('#banksBtn').show();
        });

         $('#companyFormModal').on('hidden.bs.modal', function (e) {
           $("#companyFrm")[0].reset();
           $("#CompanyID").val(" ");
           $("#ciaLogo").val(" ");
           $('#calleElProgreso').hide();
           $('#banksBtn').hide();
           $("#calleElProgreso").css("width","0%");
          $(".icon-choose-image").attr("src"," ");
          $company_locale_select.filter('[value="es_CR"]').prop('selected', false);
          $company_locale_select.filter('[value="en_US"]').prop('selected', false);
           crfut_companies.table.ajax.reload();
         });

         $("#companyLogo").on("change",function(evt){
           var fileReader = new FileReader();
           fileReader.onload = function (e){
             $(".icon-choose-image").attr("src",e.target.result);
           }
           fileReader.readAsDataURL(this.files[0]);
           var tmpLogo = $("#companyLogo").val();
           var logo = tmpLogo.slice(12, tmpLogo.length);//the fakepath thing
           $("#ciaLogo").val(logo);
         });

         /*$("#companyFrm").on("submit",function(){
           var data = $("#companyFrm").serializeHash();
           crfut_companies.save(data);
           return false;
         });*/

         $('#companyFrm').ajaxForm({
           url:crfut_companies.saveUrl+"?token="+Cookies.get("token"),
           type:"POST",
           dataType:'json',
           beforeSend: function() {
             var percentVal = '0%';
             $('#calleElProgreso').show();
             $("#calleElProgreso").css("width",percentVal);
           },
           uploadProgress: function(event, position, total, percentComplete) {
             var percentVal = percentComplete + '%';
             $("#calleElProgreso").css("width",percentVal);
           },
           success: (function(data){
             $("#calleElProgreso").css("width","100%");
             crfut_companies.verifyTokenizedRequest(data);
               if(data.is_success == 1){
                 crfut_companies.alert_success(data.flash);
                 $('#companyFormModal').modal('hide');
                 crfut_companies.table.ajax.reload();
               }else{
                   crfut_companies.alert_error(data.flash);
                   crfut_companies.modelErrors(data.error_list);
               }
               $('#calleElProgreso').hide();
           }).bind(crfut_companies)
         });

    });
    </script>
